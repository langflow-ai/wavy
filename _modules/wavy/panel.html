<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>wavy.panel &mdash; Wavy 0.1.9 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<script type="text/javascript">
  window.onload = function() {
    document.body.innerHTML = document.body.innerHTML.replace(/ module/g, '');
  }
</script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Wavy
          </a>
              <div class="version">
                0.1.9
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Using Wavy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../manual/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/quickstart.html">QuickStart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/panel.html">wavy.panel Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/models.html">wavy.models Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/plot.html">wavy.plot Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/utils.html">wavy.utils Module</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Wavy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>wavy.panel</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for wavy.panel</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span> <span class="nn">wavy.plot</span> <span class="kn">import</span> <span class="n">plot</span>

<span class="n">_ARG_0_METHODS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;__abs__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__pos__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__neg__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__invert__&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">_ARG_1_METHODS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;__add__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__sub__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__mul__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__rmul__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__truediv__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__ge__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__gt__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__le__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__lt__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__pow__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__eq__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__ne__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__bool__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__floordiv__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__rfloordiv__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__matmul__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__rmatmul__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__rmod__&quot;</span><span class="p">,</span>
    <span class="s2">&quot;__mod__&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Plot</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;multi_sparse&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># To see multilevel indexes</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;plotly&quot;</span>


<div class="viewcode-block" id="create_panels"><a class="viewcode-back" href="../../api/wavy.panel.create_panels.html#wavy.panel.create_panels">[docs]</a><span class="k">def</span> <span class="nf">create_panels</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">lookback</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">horizon</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">gap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="c1"># TODO: Add argument verbose to use tqdm if data is large</span>
    <span class="c1"># TODO: Sort df index first? If so, add a warning.</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a panel from a dataframe.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrame): Values DataFrame</span>
<span class="sd">        lookback (int): lookback size</span>
<span class="sd">        horizon (int): horizon size</span>
<span class="sd">        gap (int): gap between x and y</span>

<span class="sd">    Returns:</span>
<span class="sd">        ``Panel``: Data Panel</span>

<span class="sd">    Example:</span>

<span class="sd">    &gt;&gt;&gt; x, y = wavy.create_panels(hist, lookback=2, horizon=1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x_timesteps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x_timesteps</span> <span class="o">-</span> <span class="n">lookback</span> <span class="o">-</span> <span class="n">horizon</span> <span class="o">-</span> <span class="n">gap</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Not enough timesteps to build&quot;</span><span class="p">)</span>

    <span class="n">end</span> <span class="o">=</span> <span class="n">x_timesteps</span> <span class="o">-</span> <span class="n">horizon</span> <span class="o">-</span> <span class="n">gap</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lookback</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="n">xframes</span><span class="p">,</span> <span class="n">yframes</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indexes</span><span class="p">):</span>
        <span class="c1"># ? functions that create a new panel might keep old frame indexes</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">lookback</span> <span class="p">:</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">xframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">gap</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">gap</span> <span class="o">+</span> <span class="n">horizon</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">yframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Panel</span><span class="p">(</span><span class="n">xframes</span><span class="p">),</span> <span class="n">Panel</span><span class="p">(</span><span class="n">yframes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span></div>


<div class="viewcode-block" id="shallow_copy"><a class="viewcode-back" href="../../api/wavy.panel.shallow_copy.html#wavy.panel.shallow_copy">[docs]</a><span class="k">def</span> <span class="nf">shallow_copy</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">frames</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shallow copy of a panel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">frames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_panel</span> <span class="o">=</span> <span class="n">Panel</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>
    <span class="n">new_panel</span><span class="o">.</span><span class="n">train_size</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">train_size</span>
    <span class="n">new_panel</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">test_size</span>
    <span class="n">new_panel</span><span class="o">.</span><span class="n">val_size</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">val_size</span>

    <span class="k">return</span> <span class="n">new_panel</span></div>


<div class="viewcode-block" id="Panel"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel">[docs]</a><span class="k">class</span> <span class="nc">Panel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frames</span><span class="p">):</span>
        <span class="c1"># ? Should frames always have increasing indexes? Maybe add warning and reindex</span>
        <span class="c1"># ? What about duplicated indices?</span>
        <span class="c1"># ? Would it make sense to have the panel as only one dataframe with index references per frame window?</span>

        <span class="k">class</span> <span class="nc">_IXIndexer</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>

            <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">frames</span><span class="p">])</span>

        <span class="k">class</span> <span class="nc">_iLocIndexer</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>

            <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">frames</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="k">class</span> <span class="nc">_LocIndexer</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>

            <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">frames</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="k">class</span> <span class="nc">_AtIndexer</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>

            <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">frames</span><span class="p">])</span>

        <span class="k">class</span> <span class="nc">_iAtIndexer</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>

            <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">frames</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="k">class</span> <span class="nc">_IXIndexer</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>

            <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">frames</span><span class="p">])</span>

        <span class="k">class</span> <span class="nc">_iLocIndexer</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>

            <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">frames</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="k">class</span> <span class="nc">_LocIndexer</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>

            <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">frames</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="k">class</span> <span class="nc">_AtIndexer</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>

            <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">frames</span><span class="p">])</span>

        <span class="k">class</span> <span class="nc">_iAtIndexer</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>

            <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">frames</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ix</span> <span class="o">=</span> <span class="n">_IXIndexer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iloc</span> <span class="o">=</span> <span class="n">_iLocIndexer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="n">_LocIndexer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at</span> <span class="o">=</span> <span class="n">_AtIndexer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iat</span> <span class="o">=</span> <span class="n">_iAtIndexer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_training_split</span><span class="p">()</span>

    <span class="c1"># TODO: add setattr, e.g. for renaming columns ()</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">)):</span>
                    <span class="n">new_frame</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">name</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_frame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                        <span class="n">new_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_frame</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_frame</span>
                <span class="k">return</span> <span class="bp">self</span>

                <span class="c1"># new_frames = []</span>
                <span class="c1"># for frame in range(len(self.frames)):</span>
                <span class="c1">#     new_frame = getattr(frame, name)(*args, **kwargs)</span>
                <span class="c1">#     if isinstance(new_frame, pd.Series):</span>
                <span class="c1">#         new_frame = pd.DataFrame(new_frame).T</span>
                <span class="c1">#     self.frames[0] = new_frame</span>
                <span class="c1">#     new_frames.append(new_frame)</span>
                <span class="c1">#     return Panel(new_frames)</span>

            <span class="k">return</span> <span class="n">wrapper</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;Panel&#39; object has no attribute &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Function to map all dunder functions</span>
    <span class="k">def</span> <span class="nf">_1_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">__f</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Panel</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="p">[</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">__f</span><span class="p">)(</span><span class="n">other_frame</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">frame</span><span class="p">,</span> <span class="n">other_frame</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">frames</span><span class="p">)</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">__f</span><span class="p">)(</span><span class="n">other</span><span class="p">)</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">_dunder</span> <span class="ow">in</span> <span class="n">_ARG_1_METHODS</span><span class="p">:</span>
        <span class="nb">locals</span><span class="p">()[</span><span class="n">_dunder</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">__f</span><span class="o">=</span><span class="n">_dunder</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_1_arg</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">__f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_0_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__f</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">__f</span><span class="p">)()</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">_dunder</span> <span class="ow">in</span> <span class="n">_ARG_0_METHODS</span><span class="p">:</span>
        <span class="nb">locals</span><span class="p">()[</span><span class="n">_dunder</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">__f</span><span class="o">=</span><span class="n">_dunder</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_0_arg</span><span class="p">(</span><span class="n">__f</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="c1"># TODO: add support for dates x[&#39;2016&#39;:] (reference pandas)</span>
        <span class="c1"># TODO: add support for exclusion / set operation, e.g. x[x.index &lt; 1000 &amp; x.index &gt; 2000] (reference pandas)</span>
        <span class="c1"># ? What if the panel was a np.array of frames, instead of a list of frames?</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="p">),</span> <span class="s2">&quot;Panel indexing must be int, slice, list, str or tuple&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># TODO: check if list is a list of ints or strings. If not, try casting before raising error.</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span>
            <span class="p">),</span> <span class="s2">&quot;Panel indexing with list must be int or str&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="p">),</span> <span class="s2">&quot;Panel indexing rows with tuple must be int, slice or list&quot;</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">columns</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="p">),</span> <span class="s2">&quot;Panel indexing columns with tuple must be str or list&quot;</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">index</span>
                <span class="p">),</span> <span class="s2">&quot;Panel indexing rows with list must be int&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">columns</span>
                <span class="p">),</span> <span class="s2">&quot;Panel indexing columns with list must be str&quot;</span>

        <span class="c1"># Tuple</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">columns</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">columns</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="n">columns</span>
                <span class="p">]</span>

        <span class="c1"># Columns</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">key</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="n">key</span><span class="p">]]</span>

        <span class="c1"># Index</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                <span class="s2">&quot;timesteps&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">,</span>
                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">},</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Panel&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Panel, size </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the indices of the panel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Panel columns.</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; panel.columns</span>
<span class="sd">        Index([&#39;Open&#39;, &#39;High&#39;, &#39;Low&#39;, &#39;Close&#39;], dtype=&#39;object&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the last index of each frame in the panel.</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; panel.index</span>
<span class="sd">        0   2022-05-04</span>
<span class="sd">        1   2022-05-05</span>
<span class="sd">        2   2022-05-06</span>
<span class="sd">        3   2022-05-09</span>
<span class="sd">        dtype: datetime64[ns]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        3D matrix with Panel value.</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; panel.values</span>
<span class="sd">        array([[[283.95999146, 284.13000488, 280.1499939 , 281.77999878],</span>
<span class="sd">                [282.58999634, 290.88000488, 276.73001099, 289.98001099]],</span>
<span class="sd">               [[282.58999634, 290.88000488, 276.73001099, 289.98001099],</span>
<span class="sd">                [285.54000854, 286.3500061 , 274.33999634, 277.3500061 ]],</span>
<span class="sd">               [[285.54000854, 286.3500061 , 274.33999634, 277.3500061 ],</span>
<span class="sd">                [274.80999756, 279.25      , 271.26998901, 274.73001099]],</span>
<span class="sd">               [[274.80999756, 279.25      , 271.26998901, 274.73001099],</span>
<span class="sd">                [270.05999756, 272.35998535, 263.32000732, 264.57998657]]])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">frame</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">)]</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">timesteps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of timesteps in the panel.</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; panel.timesteps</span>
<span class="sd">        4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Panel shape.</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; panel.shape</span>
<span class="sd">        (4, 2, 4)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

<div class="viewcode-block" id="Panel.countna"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.countna">[docs]</a>    <span class="k">def</span> <span class="nf">countna</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Count NaN cells for each Dataframe.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``DataFrame``: NaN count for each frame.</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; panel.countna()</span>
<span class="sd">           nan</span>
<span class="sd">        0    0</span>
<span class="sd">        1    0</span>
<span class="sd">        2    0</span>
<span class="sd">        3    0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nan&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Panel.dropna"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.dropna">[docs]</a>    <span class="k">def</span> <span class="nf">dropna</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop rows or columns with missing values.</span>

<span class="sd">        Similar to `Pandas dropna &lt;https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop.html&gt;`__</span>

<span class="sd">        Args:</span>
<span class="sd">            axis (int): The axis to drop on.</span>
<span class="sd">            how (str): Method to use for dropping.</span>
<span class="sd">            thresh (int): The number of non-NA values to require.</span>
<span class="sd">            subset (list): List of columns to check.</span>
<span class="sd">            verbose (bool): Whether to print progress.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Dropped panel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_panel</span> <span class="o">=</span> <span class="n">shallow_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_panel</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">how</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="n">thresh</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span>
        <span class="p">]</span>
        <span class="c1"># new_panel = Panel(</span>
        <span class="c1">#     [</span>
        <span class="c1">#         frame.dropna(axis=axis, how=how, thresh=thresh, subset=subset)</span>
        <span class="c1">#         for frame in self.frames</span>
        <span class="c1">#     ]</span>
        <span class="c1"># )</span>

        <span class="n">different</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">new_panel</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_panel</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">different</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Dropped frames have different shape&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_panel</span></div>

<div class="viewcode-block" id="Panel.dropnaw"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.dropnaw">[docs]</a>    <span class="k">def</span> <span class="nf">dropnaw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop frames with missing values from the panel.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Panel with missing values dropped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nan_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findna</span><span class="p">()</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nan_values</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">idx</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;dropna&#39; would create empty Panel&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>

<div class="viewcode-block" id="Panel.findna"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.findna">[docs]</a>    <span class="k">def</span> <span class="nf">findna</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find NaN values index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``List``: List with index of NaN values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">frame</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="Panel.findinf"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.findinf">[docs]</a>    <span class="k">def</span> <span class="nf">findinf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find Inf values index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``List``: List with index of Inf values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">frame</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="Panel.as_dataframe"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.as_dataframe">[docs]</a>    <span class="k">def</span> <span class="nf">as_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert panel to DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            flatten (bool): Whether to flatten the panel.</span>
<span class="sd">            frame (bool): Whether to include frame or not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``DataFrame``: Panel as DataFrame.</span>

<span class="sd">        Example:</span>

<span class="sd">        Panel containing two frames will present the following result:</span>

<span class="sd">        &gt;&gt;&gt; panel[0]</span>
<span class="sd">                          Open        High         Low       Close</span>
<span class="sd">        Date</span>
<span class="sd">        2022-05-06  274.809998  279.250000  271.269989  274.730011</span>
<span class="sd">        2022-05-09  270.059998  272.359985  263.320007  264.579987</span>

<span class="sd">        &gt;&gt;&gt; panel.as_dataframe()</span>
<span class="sd">                          Open        High         Low       Close  frame</span>
<span class="sd">        Date</span>
<span class="sd">        2022-05-06  274.809998  279.250000  271.269989  274.730011      2</span>
<span class="sd">        2022-05-09  270.059998  272.359985  263.320007  264.579987      3</span>

<span class="sd">        &gt;&gt;&gt; panel.as_dataframe(flatten=True)</span>
<span class="sd">                        0-Open      0-High       0-Low     0-Close      1-Open      1-High       1-Low     1-Close</span>
<span class="sd">        2022-05-09  274.809998  279.250000  271.269989  274.730011  270.059998  272.359985  263.320007  264.579987</span>
<span class="sd">        2022-05-10  270.059998  272.359985  263.320007  264.579987  271.690002  273.750000  265.070007  269.500000</span>
<span class="sd">        2022-05-11  271.690002  273.750000  265.070007  269.500000  265.679993  271.359985  259.299988  260.549988</span>
<span class="sd">        2022-05-12  265.679993  271.359985  259.299988  260.549988  257.690002  259.880005  250.020004  255.350006</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">flatten</span><span class="p">:</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">])</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_frames</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">frame</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="s2">&quot;frame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span>
                <span class="n">list_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_frames</span><span class="p">)</span>
            <span class="c1"># dataframe.drop_duplicates(inplace=True) # ! didn&#39;t make sense</span>
            <span class="k">return</span> <span class="n">dataframe</span></div>

<div class="viewcode-block" id="Panel.shiftw"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.shiftw">[docs]</a>    <span class="k">def</span> <span class="nf">shiftw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shift panel by desired number of frames.</span>

<span class="sd">        Similar to `Pandas shift &lt;https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.shift.html&gt;`__</span>

<span class="sd">        Args:</span>
<span class="sd">            window (int): Number of frames to shift</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Result of shift function.</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; panel[0]</span>
<span class="sd">                          Open        High         Low       Close</span>
<span class="sd">        Date</span>
<span class="sd">        2022-05-06  274.809998  279.250000  271.269989  274.730011</span>
<span class="sd">        2022-05-09  270.059998  272.359985  263.320007  264.579987</span>

<span class="sd">        &gt;&gt;&gt; panel = panel.shift(window = 1)</span>

<span class="sd">        &gt;&gt;&gt; panel[0]</span>
<span class="sd">                   Open  High  Low Close</span>
<span class="sd">        Date</span>
<span class="sd">        2022-05-06  NaN   NaN  NaN   NaN</span>
<span class="sd">        2022-05-09  NaN   NaN  NaN   NaN</span>

<span class="sd">        &gt;&gt;&gt; panel[1]</span>
<span class="sd">                          Open        High         Low       Close</span>
<span class="sd">        Date</span>
<span class="sd">        2022-05-06  274.809998  279.250000  271.269989  274.730011</span>
<span class="sd">        2022-05-09  270.059998  272.359985  263.320007  264.579987</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new_panel</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">):</span>
            <span class="n">new_index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">window</span>
            <span class="n">new_index</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">new_index</span> <span class="k">if</span> <span class="n">new_index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">new_index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="n">new_values</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">new_index</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="k">if</span> <span class="n">new_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="p">)</span>
            <span class="n">new_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">new_values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span>
            <span class="p">)</span>
            <span class="n">new_panel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_frame</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">shallow_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_panel</span><span class="p">)</span></div>

<div class="viewcode-block" id="Panel.diffw"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.diffw">[docs]</a>    <span class="k">def</span> <span class="nf">diffw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Difference between frames.</span>

<span class="sd">        Similar to `Pandas diff &lt;https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.diff.html&gt;`__</span>

<span class="sd">        Args:</span>
<span class="sd">            window (int): Number of frames to diff</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Result of diff function.</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; panel[0]</span>
<span class="sd">                          Open        High         Low       Close</span>
<span class="sd">        Date</span>
<span class="sd">        2022-05-06  274.809998  279.250000  271.269989  274.730011</span>
<span class="sd">        2022-05-09  270.059998  272.359985  263.320007  264.579987</span>

<span class="sd">        &gt;&gt;&gt; panel = panel.diff(window = 1)</span>

<span class="sd">        &gt;&gt;&gt; panel[0]</span>
<span class="sd">                   Open  High  Low Close</span>
<span class="sd">        Date</span>
<span class="sd">        2022-05-06  NaN   NaN  NaN   NaN</span>
<span class="sd">        2022-05-09  NaN   NaN  NaN   NaN</span>

<span class="sd">        &gt;&gt;&gt; panel[1]</span>
<span class="sd">                        Open      High       Low      Close</span>
<span class="sd">        Date</span>
<span class="sd">        2022-05-09 -4.750000 -6.890015 -7.949982 -10.150024</span>
<span class="sd">        2022-05-10  1.630005  1.390015  1.750000   4.920013</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">shiftw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span></div>

<div class="viewcode-block" id="Panel.pct_changew"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.pct_changew">[docs]</a>    <span class="k">def</span> <span class="nf">pct_changew</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Percentage change between the current and a prior frame.</span>

<span class="sd">        Similar to `Pandas pct_change &lt;https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.pct_change.html&gt;`__</span>

<span class="sd">        Args:</span>
<span class="sd">            window (int): Number of frames to calculate percent change</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Result of pct_change function.</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; panel[0]</span>
<span class="sd">                          Open        High         Low       Close</span>
<span class="sd">        Date</span>
<span class="sd">        2022-05-06  274.809998  279.250000  271.269989  274.730011</span>
<span class="sd">        2022-05-09  270.059998  272.359985  263.320007  264.579987</span>

<span class="sd">        &gt;&gt;&gt; panel = panel.pct_change(window = 1)</span>

<span class="sd">        &gt;&gt;&gt; panel[0]</span>
<span class="sd">                    Open  High  Low  Close</span>
<span class="sd">        Date</span>
<span class="sd">        2022-05-06   NaN   NaN  NaN    NaN</span>
<span class="sd">        2022-05-09   NaN   NaN  NaN    NaN</span>

<span class="sd">        &gt;&gt;&gt; panel[1]</span>
<span class="sd">                        Open      High       Low     Close</span>
<span class="sd">        Date</span>
<span class="sd">        2022-05-09 -0.017285 -0.024673 -0.029307 -0.036945</span>
<span class="sd">        2022-05-10  0.006036  0.005104  0.006646  0.018596</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shiftw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span></div>

<div class="viewcode-block" id="Panel.match"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.match">[docs]</a>    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modify using values from another Panel. Aligns on indices.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: (Panel)</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Result of match function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">shallow_copy</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="n">frame</span>
                <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">indices</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">test_size</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">val_size</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">val_size</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">train_size</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">train_size</span>
        <span class="k">return</span> <span class="n">panel</span></div>

<div class="viewcode-block" id="Panel.set_training_split"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.set_training_split">[docs]</a>    <span class="k">def</span> <span class="nf">set_training_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">val_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Time series split into training, validation, and test sets, avoiding data leakage.</span>
<span class="sd">        Splits the panel in training, validation, and test panels, accessed with the properties</span>
<span class="sd">        .train, .val and .test. The sum of the three sizes inserted must equals one.</span>
<span class="sd">        Args:</span>
<span class="sd">            val_size (float): Percentage of data used for the validation set.</span>
<span class="sd">            test_size (float): Percentage of data used for the test set.</span>
<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; panel.set_training_split(val_size=0.2, test_size=0.1)</span>
<span class="sd">        &gt;&gt;&gt; train = panel.train</span>
<span class="sd">        &gt;&gt;&gt; val = panel.val</span>
<span class="sd">        &gt;&gt;&gt; test = panel.test</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">train_size</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">test_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_size</span> <span class="o">=</span> <span class="n">test_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_size</span> <span class="o">=</span> <span class="n">val_split</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_size</span>
        <span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1e-6</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Panel.update"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the panel with values from another panel.</span>

<span class="sd">        Args:</span>
<span class="sd">            other (Panel): Panel to update with.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Result of update function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If using different sizes, other must be a DataFrame&quot;</span><span class="p">)</span>

            <span class="k">assert</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">())</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Sizes don&#39;t match. Using dataframe indexes and columns to update.&quot;</span>
            <span class="p">)</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">j</span>
        <span class="k">return</span> <span class="n">panel</span></div>

<div class="viewcode-block" id="Panel.head"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.head">[docs]</a>    <span class="k">def</span> <span class="nf">head</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the first n frames of the panel.</span>

<span class="sd">        Args:</span>
<span class="sd">            n (int): Number of frames to return.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Result of head function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span></div>

<div class="viewcode-block" id="Panel.tail"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.tail">[docs]</a>    <span class="k">def</span> <span class="nf">tail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the last n frames of the panel.</span>

<span class="sd">        Args:</span>
<span class="sd">            n (int): Number of frames to return.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Result of tail function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span></div>

<div class="viewcode-block" id="Panel.sample"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.sample">[docs]</a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">how</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample panel returning a subset of frames.</span>

<span class="sd">        Args:</span>
<span class="sd">            samples (int): Number of samples to keep</span>
<span class="sd">            how (str): Resempling how, &#39;first&#39;, &#39;last&#39; or &#39;spaced&#39;</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Result of sample function.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">how</span> <span class="o">==</span> <span class="s2">&quot;first&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[:</span><span class="n">samples</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">how</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="n">samples</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="n">how</span> <span class="o">==</span> <span class="s2">&quot;spaced&quot;</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">),</span> <span class="n">samples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span></div>
        <span class="c1"># TODO: Add random sample too</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Panel with the pairs of the training set, according to</span>
<span class="sd">        the parameters given in the &#39;set_train_val_test_sets&#39; function.</span>
<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Panel with the pairs of the training set.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="p">[:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_size</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Panel with the pairs of the validation set, according to</span>
<span class="sd">        the parameters given in the &#39;set_train_val_test_sets&#39; function.</span>
<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Panel with the pairs of the validation set.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_size</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_size</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Panel with the pairs of the testing set, according to</span>
<span class="sd">        the parameters given in the &#39;set_train_val_test_sets&#39; function.</span>
<span class="sd">        Returns:</span>
<span class="sd">            ``Panel``: Panel with the pairs of the testing set.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">train_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_size</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="p">:]</span>

<div class="viewcode-block" id="Panel.plot"><a class="viewcode-back" href="../../api/wavy.panel.Panel.html#wavy.panel.Panel.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split_sets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10_000</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the panel.</span>

<span class="sd">        Args:</span>
<span class="sd">            split_sets (bool): If True, plot the training, validation, and test sets.</span>
<span class="sd">            **kwargs: Additional arguments to pass to the plot function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``plot``: Result of plot function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">max</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;spaced&#39;</span><span class="p">),</span> <span class="n">split_sets</span><span class="o">=</span><span class="n">split_sets</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split_sets</span><span class="o">=</span><span class="n">split_sets</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Logspace.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>